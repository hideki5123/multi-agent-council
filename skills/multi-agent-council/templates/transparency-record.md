# Transparency Record Template

The Transparency Record documents what information was sent to external LLMs during a council session. This enables auditing, debugging, and compliance verification.

---

## Full Transparency Record (v0.1)

```yaml
# Transparency Record v0.1
# Generated by Multi-Agent Council Skill

---
record_version: "0.1"
run_id: "{run_id}"
timestamp: "{timestamp}"

# Session Information
session:
  mode: "{mode}"  # architecture | review
  user_query_hash: "{query_hash}"  # SHA-256 of sanitized query
  query_preview: "{first_100_chars}..."

# Transport Configuration
transport:
  configured: "{transport_config}"  # auto | mcp | cli
  results:
    - provider: "openai"
      transport_used: "mcp"
      fallback_triggered: false
    - provider: "gemini"
      transport_used: "cli"
      fallback_triggered: true
      fallback_reason: "MCP connection timeout"

# Provider Details
providers:
  - provider: "claude"
    model: "claude-sonnet-4-20250514"
    role: ["participant", "chair"]
    rounds_participated: ["R1", "R2", "R3"]
    status: "ok"
    metrics:
      latency_ms: 2340
      tokens_in: 15420
      tokens_out: 1856

  - provider: "openai"
    model: "gpt-4o"
    role: ["participant"]
    rounds_participated: ["R1", "R2"]
    status: "ok"
    metrics:
      latency_ms: 3120
      tokens_in: 15420
      tokens_out: 2104

  - provider: "gemini"
    model: "gemini-2.0-flash"
    role: ["participant"]
    rounds_participated: ["R1", "R2"]
    status: "partial"
    error: "R2 timeout after 90000ms"
    metrics:
      latency_ms: 4560
      tokens_in: 15420
      tokens_out: 1678

# Context Pack Information
context_pack:
  type: "{pack_type}"  # full | summary
  selection_reason: "Content size within limits"

  source:
    root_path: "{project_root}"
    scan_timestamp: "{scan_time}"

  statistics:
    files_scanned: 156
    files_included: 87
    files_excluded: 69

  exclusions:
    by_pattern: 45
    by_size: 3
    by_binary: 18
    by_credentials: 3

  content:
    total_bytes: 245678
    truncated_files: 2
    key_files_count: 12

# Aggregate Metrics
aggregate:
  total_duration_ms: 12450
  total_tokens_in: 46260
  total_tokens_out: 5638
  total_tokens: 51898
  estimated_cost_usd: 0.45  # If calculable

  rounds:
    R1:
      duration_ms: 4200
      providers_attempted: 3
      providers_succeeded: 3
    R2:
      duration_ms: 5800
      providers_attempted: 3
      providers_succeeded: 2
    R3:
      duration_ms: 2450
      providers_attempted: 1
      providers_succeeded: 1

# Short Circuit (if applicable)
short_circuit:
  triggered: false
  # If triggered:
  # reason: "High agreement in R1"
  # rounds_skipped: ["R2", "R3"]
  # confidence_adjustment: -0.1

---
```

---

## Compact Transparency Record

For quick inspection or logging:

```yaml
transparency:
  run: "{run_id}"
  time: "{timestamp}"
  mode: "{mode}"
  pack: "{pack_type}"
  providers: ["claude", "openai", "gemini"]
  tokens: {in: 46260, out: 5638}
  duration_ms: 12450
  status: "ok"  # ok | partial | failed
```

---

## JSON Format

```json
{
  "record_version": "0.1",
  "run_id": "{run_id}",
  "timestamp": "{timestamp}",
  "session": {
    "mode": "architecture",
    "user_query_hash": "sha256:abc123...",
    "query_preview": "Should we migrate from REST to..."
  },
  "transport": {
    "configured": "auto",
    "results": [
      {
        "provider": "openai",
        "transport_used": "mcp",
        "fallback_triggered": false
      }
    ]
  },
  "providers": [
    {
      "provider": "claude",
      "model": "claude-sonnet-4-20250514",
      "role": ["participant", "chair"],
      "rounds_participated": ["R1", "R2", "R3"],
      "status": "ok",
      "metrics": {
        "latency_ms": 2340,
        "tokens_in": 15420,
        "tokens_out": 1856
      }
    }
  ],
  "context_pack": {
    "type": "full",
    "selection_reason": "Content size within limits",
    "statistics": {
      "files_scanned": 156,
      "files_included": 87,
      "files_excluded": 69
    },
    "content": {
      "total_bytes": 245678,
      "truncated_files": 2,
      "key_files_count": 12
    }
  },
  "aggregate": {
    "total_duration_ms": 12450,
    "total_tokens_in": 46260,
    "total_tokens_out": 5638,
    "estimated_cost_usd": 0.45
  }
}
```

---

## Log Line Format

Single-line format for log aggregation:

```
COUNCIL run={run_id} mode={mode} pack={pack_type} providers=3 files_sent=87 tokens_in=46260 tokens_out=5638 duration_ms=12450 status=ok
```

---

## Fields Reference

### Required Fields (v0.1)

| Field | Type | Description |
|-------|------|-------------|
| `run_id` | string | Unique identifier for the council run |
| `timestamp` | string | ISO 8601 timestamp of run start |
| `mode` | string | "architecture" or "review" |
| `transport_config` | string | "auto", "mcp", or "cli" |
| `providers` | array | List of provider records |
| `context_pack.type` | string | "full" or "summary" |
| `context_pack.statistics.files_included` | number | Files sent to external LLMs |
| `aggregate.total_duration_ms` | number | Total execution time |

### Optional Fields (v0.1)

| Field | Type | Description |
|-------|------|-------------|
| `user_query_hash` | string | SHA-256 of sanitized query (privacy) |
| `query_preview` | string | First 100 chars of query |
| `tokens_in` | number | Input tokens (if available) |
| `tokens_out` | number | Output tokens (if available) |
| `estimated_cost_usd` | number | Cost estimate (if calculable) |
| `error` | string | Error message if provider failed |

### Future Fields (TBD)

These fields are planned but not finalized:

| Field | Description |
|-------|-------------|
| `files_sent` | Exact list of files sent |
| `prompt_content_hash` | Hash of exact prompt content |
| `precise_token_counts` | Per-message token counts |
| `data_classification` | Sensitivity level of data sent |
| `approval_id` | Reference to approval workflow |

---

## Storage and Retention

### Default Behavior
- Records stored in memory during session
- Optionally written to `~/.council/transparency/` on completion
- Retention period: configurable (default: 30 days)

### File Naming
```
{run_id}.transparency.yaml
# or
{run_id}.transparency.json
```

### Directory Structure
```
~/.council/
└── transparency/
    ├── 2024-01-15/
    │   ├── abc123.transparency.yaml
    │   └── def456.transparency.yaml
    └── 2024-01-16/
        └── ghi789.transparency.yaml
```

---

## Privacy Considerations

### What is Recorded
- File counts and sizes (not content)
- Token counts (aggregate)
- Provider and model identifiers
- Timing information
- Error messages (sanitized)

### What is NOT Recorded (by default)
- Actual file contents sent
- Full prompt text
- Full response text
- API keys or credentials
- User identifying information

### Opt-in Detailed Recording
For debugging, users can enable detailed recording:
```yaml
council:
  transparency:
    level: "detailed"  # minimal | standard | detailed
    include_prompts: true
    include_responses: false
```

---

## Usage Examples

### Viewing a Record
```bash
cat ~/.council/transparency/2024-01-15/abc123.transparency.yaml
```

### Querying Records
```bash
# Find all runs that sent more than 100 files
grep -l "files_included: [1-9][0-9][0-9]" ~/.council/transparency/**/*.yaml

# Find failed runs
grep -l "status: failed" ~/.council/transparency/**/*.yaml
```

### Aggregating Metrics
```bash
# Sum tokens used today
yq '.aggregate.total_tokens' ~/.council/transparency/$(date +%Y-%m-%d)/*.yaml | awk '{sum+=$1} END {print sum}'
```

---

## Compliance Notes

This transparency record supports:
- **Audit trails**: Track what was sent externally
- **Cost monitoring**: Estimate API costs
- **Debugging**: Understand failures
- **Privacy review**: Verify sensitive data handling

For regulated environments, consider:
- Enabling detailed logging
- Setting appropriate retention periods
- Encrypting stored records
- Integrating with enterprise logging systems
